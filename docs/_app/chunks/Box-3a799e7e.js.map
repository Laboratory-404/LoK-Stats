{"version":3,"file":"Box-3a799e7e.js","sources":["../../../../../src/lib/variables.js","../../../../../src/lib/api.js","../../../../../src/lib/components/Box.svelte"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols\nexport const variables = {\n\tMODE: import.meta.env.MODE,\n\tDEV: import.meta.env.DEV,\n\tPROD: import.meta.env.PROD,\n\tBASE_URL: import.meta.env.BASE_URL,\n\tAPI_ROOT: import.meta.env.VITE_API_ROOT,\n\tETHERSCAN_API_ROOT: import.meta.env.VITE_ETHERSCAN_API_ROOT,\n\tETHERSCAN_API_KEY: import.meta.env.VITE_ETHERSCAN_API_KEY\n}","// noinspection DuplicatedCode,JSUnusedGlobalSymbols\n\nimport { get } from 'svelte/store'\nimport { db } from '$lib/stores'\nimport { variables } from '$lib/variables'\n\nconst GLOBAL_TIMEOUT = 5000\nconst GLOBAL_RETRIES = 1\nconst GLOBAL_RETRY_DELAY = 100\n\nconst delay = delay => new Promise(resolve => setTimeout(() => resolve(), delay))\n\nconst fetchWithTimeout = async (resource, options = {}, f) => {\n\t//console.log(`fetchWithTimeout(${resource})`)\n\n\tlet id = null\n\tlet response\n\n\tif (typeof AbortController === 'function') {\n\t\tconst { timeout = GLOBAL_TIMEOUT } = options\n\t\tconst controller = new AbortController()\n\t\tid = setTimeout(() => controller.abort(), timeout)\n\n\t\tif (typeof f === 'function') {\n\t\t\t//console.log(`Server-side fetch ${resource}`)\n\t\t\tresponse = await f(resource, { ...options, signal: controller.signal })\n\t\t} else {\n\t\t\tresponse = await fetch(resource, { ...options, signal: controller.signal })\n\t\t}\n\t} else {\n\t\tif (typeof f === 'function') {\n\t\t\t//console.log(`Server-side fetch ${resource}`)\n\t\t\tresponse = await f(resource, options)\n\t\t} else {\n\t\t\tresponse = await fetch(resource, options)\n\t\t}\n\t}\n\n\tif (id !== null) {\n\t\tclearTimeout(id)\n\t}\n\n\treturn response\n}\n\nconst fetchWithRetryDelay = async (resource, options = {}, f, n = GLOBAL_RETRIES) => {\n\t//console.log(`fetchWithRetryDelay(${resource})`)\n\n\ttry {\n\t\treturn await fetchWithTimeout(resource, options, f)\n\t} catch(error) {\n\t\tconsole.error(error)\n\n\t\tif (n === 1) throw error\n\n\t\tawait delay(GLOBAL_RETRY_DELAY)\n\n\t\treturn fetchWithRetryDelay(resource, options, f, n - 1)\n\t}\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport const EtherScanAPI = {\n\tgetContractABI: (contract_address, f, options) => fetchWithRetryDelay(`${variables.ETHERSCAN_API_ROOT}?module=contract&action=getabi&address=${contract_address}&page=1&startblock=0&sort=asc&apikey=${variables.ETHERSCAN_API_KEY}`, options, f),\n\tgetBalance: (contract_address, wallet_address, f, options) => fetchWithRetryDelay(`${variables.ETHERSCAN_API_ROOT}?module=account&action=tokenbalance&contractaddress=${contract_address}&address=${wallet_address}&tag=latest&&apikey=${variables.ETHERSCAN_API_KEY}`, options, f),\n\tgetTransferEvents: (contract_address, wallet_address, nft = false, f, options) => fetchWithRetryDelay(`${variables.ETHERSCAN_API_ROOT}?module=account&action=${!nft ? 'tokentx' : 'tokennfttx'}&contractaddress=${contract_address}&address=${wallet_address}&apikey=${variables.ETHERSCAN_API_KEY}`, options, f)\n}\n\nexport const getContributions = (land, start, end, f, options) => fetchWithRetryDelay(`${variables.API_ROOT}/stat/land/contribution?landId=${land}&from=${start}&to=${end}`, options, f)\n\nexport const getCount = async (wallet_address, contract_address) => {\n\tlet $db = get(db)\n\tlet wallet = wallet_address || $db.wallet\n\tlet contract = contract_address || $db.contract\n\tlet balance_api = await EtherScanAPI.getBalance(contract, wallet).catch(error => console.error(error))\n\tlet balance_data = await balance_api?.json().catch(error => console.error(error))\n\n\tif (balance_data?.message === 'OK' && balance_data?.status === '1') {\n\t\treturn parseInt(balance_data?.result)\n\t}\n\n\treturn 0\n}\n\nexport const getLands = async (wallet_address, contract_address) => {\n\tlet tokens = []\n\tlet $db = get(db)\n\tlet wallet = wallet_address || $db.wallet\n\tlet contract = contract_address || $db.contract\n\tlet transfers_api = await EtherScanAPI.getTransferEvents(contract, wallet, true).catch(error => console.error(error))\n\tlet transfers_data = await transfers_api?.json().catch(error => console.error(error))\n\n\tif (transfers_data.message === 'OK' && transfers_data.status === '1' && Array.isArray(transfers_data.result)) {\n\t\ttransfers_data.result.map(({tokenName, tokenSymbol, tokenID }) => {\n\t\t\t// noinspection JSUnresolvedVariable\n\t\t\tif (tokenName === 'League of Kingdoms LAND' && tokenSymbol === 'LOKL') {\n\t\t\t\t// noinspection JSUnresolvedVariable\n\t\t\t\ttokens.push(tokenID)\n\t\t\t}\n\t\t})\n\t}\n\n\treturn tokens\n}\n\nexport const getData = (lands, start, end) => {\n\tlet $db = get(db)\n\tlet l = lands || $db.lands\n\tlet s = start || $db.start\n\tlet e = end || $db.end\n\n\tif (Array.isArray($db.data))  {\n\t\tif ($db.data.length === 0) {\n\t\t\t$db.data = [{ start: s, end: e, data: {}}]\n\n\t\t\t$db.data.map((p, i) => {\n\t\t\t\tif (p.start === s && p.end === e) {\n\t\t\t\t\tl.map(async land => {\n\t\t\t\t\t\tlet contributions_api = await getContributions(land, s, e).catch(error => console.error(error))\n\t\t\t\t\t\tlet contributions_data = await contributions_api?.json().catch(error => console.error(error))\n\n\t\t\t\t\t\tif (typeof p.data === 'undefined') {\n\t\t\t\t\t\t\t$db.data[i].data = {}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$db.data[i].data[land] = contributions_data\n\n\t\t\t\t\t\tdb.set($db)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tconsole.log('Loaded from server')\n\t\t} else {\n\t\t\tlet found = false\n\n\t\t\t$db.data.map(p => {\n\t\t\t\tif (p.start === s && p.end === e) {\n\t\t\t\t\tfound = true\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tif (found) {\n\t\t\t\t$db.data.map((p, i) => {\n\t\t\t\t\tif (p.start === s && p.end === e) {\n\t\t\t\t\t\tif (p.data && Object.keys(p.data).length === 0) {\n\t\t\t\t\t\t\tl.map(async land => {\n\t\t\t\t\t\t\t\tlet contributions_api = await getContributions(land, s, e).catch(error => console.error(error))\n\t\t\t\t\t\t\t\tlet contributions_data = await contributions_api?.json().catch(error => console.error(error))\n\n\t\t\t\t\t\t\t\tif (typeof p.data === 'undefined') {\n\t\t\t\t\t\t\t\t\t$db.data[i].data = {}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$db.data[i].data[land] = contributions_data\n\n\t\t\t\t\t\t\t\tdb.set($db)\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tconsole.log('Loaded from server')\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Loaded from cache')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\t$db.data.push({ start: s, end: e, data: {}})\n\n\t\t\t\t$db.data.map((p, i) => {\n\t\t\t\t\tif (p.start === s && p.end === e) {\n\t\t\t\t\t\tl.map(async land => {\n\t\t\t\t\t\t\tlet contributions_api = await getContributions(land, s, e).catch(error => console.error(error))\n\t\t\t\t\t\t\t// noinspection UnnecessaryLocalVariableJS\n\t\t\t\t\t\t\tlet contributions_data = await contributions_api?.json().catch(error => console.error(error))\n\n\t\t\t\t\t\t\tif (typeof p.data === 'undefined') {\n\t\t\t\t\t\t\t\t$db.data[i].data = {}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$db.data[i].data[land] = contributions_data\n\n\t\t\t\t\t\t\tdb.set($db)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconsole.log('Loaded from server')\n\t\t\t}\n\t\t}\n\t}\n}","<script>\n\texport let aside = false\n</script>\n\n<div class=\"box {aside ? 'aside' : ''}\" on:click {...$$props}>\n\t<slot/>\n</div>\n\n<style global lang=\"scss\">\n\t.box {\n\t\tdisplay: block;\n\t\tposition: relative;\n\t\tpadding: 20px;\n\t\t//margin-bottom: 20px;\n\t\tfont-size: 1rem;\n\t\tborder-radius: 5px;\n\t\tbox-shadow: rgba(255, 255, 255, 0.1) 0 1px 0, rgba(0, 0, 0, 0.8) 0 1px 7px 0 inset;\n\t\tbackground: rgba(0, 0, 0, 0.3);\n\t\tz-index: 0;\n\t\t//overflow-x: auto;\n\t\toverflow: hidden;\n\t}\n\n\t.box:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tclear: both;\n\t}\n\n\t.box.aside {\n\t\tfloat: right;\n\t\tmargin-left: 20px;\n\t}\n\n\t.box h1, .box h2, .box h3 {\n\t\tmargin: 1em 0 0.7em;\n\t\tcolor: #fff;\n\t\tfont-weight: normal;\n\t}\n\n\t.box > h1:first-child, .box > h2:first-child, .box > h3:first-child {\n\t\tmargin-top: 0;\n\t}\n\n\t.box h1 {\n\t\tfont-size: 1.333em;\n\t\tpadding-bottom: 0.4em;\n\t\tborder-bottom: 1px solid #121212;\n\t\tbox-shadow: 0 1px #2e2e2e;\n\t}\n\n\t.box h2, .box h3 {\n\t\tbox-sizing: content-box;\n\t\tdisplay: inline-block;\n\t\theight: 1.7em;\n\t\tposition: relative;\n\t\tleft: -22px;\n\t\tpadding: 0 22px;\n\t\tfont-size: 0.93em;\n\t\tline-height: 1.7em;\n\t\tcolor: #fc0;\n\t\tbackground: linear-gradient(to right, #270002, #610006 20%, #610006 80%, #440004 100%);\n\t\tborder-top: 1px solid #8a0009;\n\t\tborder-bottom: 1px solid #180002;\n\t\tborder-radius: 0 0 0 5px;\n\t\tbox-shadow: 0 3px 10px -5px #000;\n\t\tclip-path: polygon(0 -5%, 100% -5%, 92% 50%, 100% 105%, 0 105%);\n\t}\n\n\t.box h2:before, .box h3:before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\twidth: 5px;\n\t\theight: 5px;\n\t\tposition: absolute;\n\t\ttop: -5px;\n\t\tleft: 0;\n\t\tbackground: radial-gradient(circle at top right, transparent 4px, #760007 5px, #000 100%);\n\t}\n\n\t.box h2 + ul, .box h3 + ul, .box h2 + div > ul, .box h3 + div > ul {\n\t\tmargin-top: 0.5em;\n\t}\n\n\t.box p, .box ul {\n\t\tfont-size: 0.93em;\n\t}\n\n\t.box p {\n\t\tline-height: 1.5;\n\t}\n\n\t.box > *:last-child, .box > *:last-child > *:last-child {\n\t\tmargin-bottom: 0;\n\t}\n</style>"],"names":["get"],"mappings":"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"}