{"version":3,"file":"stores-9711b9d9.js","sources":["../../../../../src/lib/persist.js","../../../../../src/lib/stores.js"],"sourcesContent":["// noinspection DuplicatedCode\n\n// import ESSerializer from 'esserializer'\nimport { get as getCookie, set as setCookie, erase as removeCookie } from 'browser-cookies'\nimport { get, set, createStore, del } from 'idb-keyval'\n\n// noinspection JSUnusedGlobalSymbols\n/**\n * Disabled warnings about missing/unavailable storages\n */\nexport function disableWarnings() { noWarnings = true }\n\n/**\n * If set to true, no warning will be emitted if the requested Storage is not found.\n * This option can be useful when the lib is used on a server.\n */\nlet noWarnings = false\n\n/**\n * List of storages where the warning have already been displayed.\n */\nconst alreadyWarnFor = []\n\n/**\n * Add a log to indicate that the requested Storage have not been found.\n */\nconst warnStorageNotFound = storageName => {\n\tconst isProduction = typeof process !== 'undefined' && process.env?.NODE_ENV === 'production'\n\n\tif (!noWarnings && alreadyWarnFor.indexOf(storageName) === -1 && !isProduction) {\n\t\tlet message = `Unable to find the ${storageName}. No data will be persisted.`\n\n\t\tif (typeof window === 'undefined') {\n\t\t\tmessage += '\\n' + 'Are you running on a server? Most of storages are not available while running on a server.'\n\t\t}\n\n\t\tconsole.warn(message)\n\t\talreadyWarnFor.push(storageName)\n\t}\n}\n\nconst allowedClasses = []\n\n// noinspection JSUnusedGlobalSymbols\n/**\n * Add a class to the allowed list of classes to be serialized\n */\nexport const addSerializableClass = classDef => { allowedClasses.push(classDef) }\n// const serialize = value => ESSerializer.serialize(value)\nconst serialize = value => JSON.stringify(value)\nconst deserialize = value => {\n\t// @TODO: to remove in the next major\n\tif (value === 'undefined') {\n\t\treturn undefined\n\t}\n\n\tif (value !== null && value !== undefined) {\n\t\t/*try {\n\t\t\treturn ESSerializer.deserialize(value, allowedClasses)\n\t\t} catch (e) {\n\t\t\t// Do nothing\n\t\t\t// use the value \"as is\"\n\t\t}*/\n\t\ttry {\n\t\t\treturn JSON.parse(value)\n\t\t} catch (e) {\n\t\t\t// Do nothing\n\t\t\t// use the value \"as is\"\n\t\t}\n\t}\n\treturn value\n}\n\n/**\n * Make a store persistent\n */\nexport function persist(store , storage, key) {\n\tconst initialValue = storage.getValue(key)\n\n\tif (null !== initialValue) {\n\t\tstore.set(initialValue)\n\t}\n\n\tif (storage.addListener) {\n\t\tstorage.addListener(key, newValue => {\n\t\t\tstore.set(newValue)\n\t\t})\n\t}\n\n\tstore.subscribe(value => {\n\t\tstorage.setValue(key, value)\n\t})\n\n\treturn {\n\t\t...store,\n\t\tdelete() {\n\t\t\tstorage.deleteValue(key)\n\t\t}\n\t}\n}\n\nfunction getBrowserStorage(browserStorage, listenExternalChanges = false) {\n\tconst listeners = []\n\tconst listenerFunction = event => {\n\t\tconst eventKey = event.key\n\n\t\tif (event.storageArea === browserStorage) {\n\t\t\tlisteners.filter(({ key }) => key === eventKey).forEach(({ listener }) => {\n\t\t\t\tlistener(deserialize(event.newValue))\n\t\t\t})\n\t\t}\n\t}\n\tconst connect = () => {\n\t\tif (listenExternalChanges && typeof window !== 'undefined' && window?.addEventListener) {\n\t\t\twindow.addEventListener('storage', listenerFunction)\n\t\t}\n\t}\n\tconst disconnect = () => {\n\t\tif (listenExternalChanges && typeof window !== 'undefined' && window?.removeEventListener) {\n\t\t\twindow.removeEventListener('storage', listenerFunction)\n\t\t}\n\t}\n\n\treturn {\n\t\taddListener(key, listener) {\n\t\t\tlisteners.push({key, listener})\n\n\t\t\tif (listeners.length === 1) {\n\t\t\t\tconnect()\n\t\t\t}\n\t\t},\n\t\tremoveListener(key, listener) {\n\t\t\tconst index = listeners.indexOf({key, listener})\n\n\t\t\tif (index !== -1) {\n\t\t\t\tlisteners.splice(index, 1)\n\t\t\t}\n\n\t\t\tif (listeners.length === 0) {\n\t\t\t\tdisconnect()\n\t\t\t}\n\t\t},\n\t\tgetValue(key) {\n\t\t\tconst value = browserStorage.getItem(key)\n\n\t\t\treturn deserialize(value)\n\t\t},\n\t\tdeleteValue(key) {\n\t\t\tbrowserStorage.removeItem(key)\n\t\t},\n\t\tsetValue(key, value) {\n\t\t\tbrowserStorage.setItem(key, serialize(value))\n\t\t}\n\t}\n}\n\n// noinspection JSUnusedGlobalSymbols\n/**\n * Storage implementation that use the browser local storage\n */\nexport function localStorage(listenExternalChanges = false) {\n\tif (typeof window !== 'undefined' && window?.localStorage) {\n\t\treturn getBrowserStorage(window.localStorage, listenExternalChanges)\n\t}\n\n\twarnStorageNotFound('window.localStorage')\n\n\treturn noopStorage()\n}\n\n// noinspection JSUnusedGlobalSymbols\n/**\n * Storage implementation that use the browser session storage\n */\nexport function sessionStorage(listenExternalChanges = false) {\n\tif (typeof window !== 'undefined' && window?.sessionStorage) {\n\t\treturn getBrowserStorage(window.sessionStorage, listenExternalChanges)\n\t}\n\n\twarnStorageNotFound('window.sessionStorage')\n\n\treturn noopStorage()\n}\n\n// noinspection JSUnusedGlobalSymbols\n/**\n * Storage implementation that use the browser cookies\n */\nexport function cookieStorage() {\n\tif (typeof document === 'undefined' || typeof document?.cookie !== 'string') {\n\t\twarnStorageNotFound('document.cookies')\n\n\t\treturn noopStorage()\n\t}\n\n\treturn {\n\t\tgetValue(key) {\n\t\t\tconst value = getCookie(key)\n\n\t\t\treturn deserialize(value)\n\t\t},\n\t\tdeleteValue(key) {\n\t\t\tremoveCookie(key, { samesite: 'Strict' })\n\t\t},\n\t\tsetValue(key, value) {\n\t\t\tsetCookie(key, serialize(value),{ samesite: 'Strict' })\n\t\t}\n\t}\n}\n\n// noinspection JSUnusedGlobalSymbols\n/**\n * Storage implementation that use the browser IndexedDB\n */\nexport function indexedDBStorage() {\n\tif (typeof indexedDB !== 'object' || typeof window === 'undefined' || typeof window?.indexedDB !== 'object') {\n\t\twarnStorageNotFound('IndexedDB')\n\n\t\treturn noopSelfUpdateStorage()\n\t}\n\n\tconst database = createStore('persist', 'persist')\n\tconst listeners = []\n\tconst listenerFunction = (eventKey, newValue) => {\n\t\tif (newValue === undefined) {\n\t\t\treturn\n\t\t}\n\n\t\tlisteners.filter(({key}) => key === eventKey).forEach(({listener}) => listener(newValue))\n\t}\n\n\treturn {\n\t\taddListener(key, listener) {\n\t\t\tlisteners.push({key, listener})\n\t\t},\n\t\tremoveListener(key, listener) {\n\t\t\tconst index = listeners.indexOf({key, listener})\n\n\t\t\tif (index !== -1) {\n\t\t\t\tlisteners.splice(index, 1)\n\t\t\t}\n\t\t},\n\t\tgetValue(key) {\n\t\t\tget(key, database).then(value => listenerFunction(key, (deserialize(value))))\n\n\t\t\treturn null\n\t\t},\n\t\tsetValue(key, value) {\n\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\tset(key, serialize(value), database)\n\t\t},\n\t\tdeleteValue(key) {\n\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\tdel(key, database)\n\t\t}\n\t}\n}\n\n/**\n * Storage implementation that do nothing\n */\nexport function noopStorage() {\n\treturn {\n\t\tgetValue() {\n\t\t\treturn null\n\t\t},\n\t\tdeleteValue() {},\n\t\tsetValue() {}\n\t}\n}\n\nfunction noopSelfUpdateStorage() {\n\treturn {\n\t\taddListener() {},\n\t\tremoveListener() {},\n\t\tgetValue() {\n\t\t\treturn null\n\t\t},\n\t\tdeleteValue() {},\n\t\tsetValue() {}\n\t}\n}","import { writable } from 'svelte/store'\nimport { persist, localStorage } from '$lib/persist'\n\n// noinspection JSUnusedGlobalSymbols\nexport const db = persist(writable({\n\tclear: false,\n\twallet: '0xB00Fc62B8B22243779A35effb8B98f18193daa09',\n\tcontract: '0x6CC462bc49ceCFE943Bc4F477b23b92906e6074F',\n\tlands: ['134223', '134224', '134225', '133969', '133968', '133967', '133711', '133712', '133713', '133455', '133456', '133457'],\n\tblacklisted: ['150949'],\n\tstart: '2022-03-21',\n\tend: '2022-03-27',\n\tweek: '2022-W13',\n\tdata: [],\n\tselected: '0'\n}), localStorage(), 'db')"],"names":[],"mappings":"sdAqBA,KAAM,GAAiB,GAKjB,EAAsB,GAAe,OAC1C,KAAM,GAAe,MAAO,UAAY,aAAe,YAAQ,MAAR,cAAa,YAAa,aAEjF,GAAmB,EAAe,QAAQ,KAAiB,IAAM,CAAC,EAAc,CAC/E,GAAI,GAAU,sBAAsB,gCAEpC,AAAI,MAAO,SAAW,aACrB,IAAW;AAAA,6FAGZ,QAAQ,KAAK,GACb,EAAe,KAAK,KAYhB,EAAY,GAAS,KAAK,UAAU,GACpC,EAAc,GAAS,CAE5B,GAAI,IAAU,YAId,IAAI,GAAU,KAOb,GAAI,CACH,MAAO,MAAK,MAAM,QACjB,EAKH,MAAO,KAMD,WAAiB,EAAQ,EAAS,EAAK,CAC7C,KAAM,GAAe,EAAQ,SAAS,GAEtC,MAAI,AAAS,KAAT,MACH,EAAM,IAAI,GAGP,EAAQ,aACX,EAAQ,YAAY,EAAK,GAAY,CACpC,EAAM,IAAI,KAIZ,EAAM,UAAU,GAAS,CACxB,EAAQ,SAAS,EAAK,KAGhB,OACH,GADG,CAEN,QAAS,CACR,EAAQ,YAAY,MAKvB,WAA2B,EAAgB,EAAwB,GAAO,CACzE,KAAM,GAAY,GACZ,EAAmB,GAAS,CACjC,KAAM,GAAW,EAAM,IAEvB,AAAI,EAAM,cAAgB,GACzB,EAAU,OAAO,CAAC,CAAE,SAAU,IAAQ,GAAU,QAAQ,CAAC,CAAE,cAAe,CACzE,EAAS,EAAY,EAAM,cAIxB,EAAU,IAAM,CACrB,AAAI,GAAyB,MAAO,SAAW,aAAe,4BAAQ,mBACrE,OAAO,iBAAiB,UAAW,IAG/B,EAAa,IAAM,CACxB,AAAI,GAAyB,MAAO,SAAW,aAAe,4BAAQ,sBACrE,OAAO,oBAAoB,UAAW,IAIxC,MAAO,CACN,YAAY,EAAK,EAAU,CAC1B,EAAU,KAAK,CAAC,MAAK,aAEjB,EAAU,SAAW,GACxB,KAGF,eAAe,EAAK,EAAU,CAC7B,KAAM,GAAQ,EAAU,QAAQ,CAAC,MAAK,aAEtC,AAAI,IAAU,IACb,EAAU,OAAO,EAAO,GAGrB,EAAU,SAAW,GACxB,KAGF,SAAS,EAAK,CACb,KAAM,GAAQ,EAAe,QAAQ,GAErC,MAAO,GAAY,IAEpB,YAAY,EAAK,CAChB,EAAe,WAAW,IAE3B,SAAS,EAAK,EAAO,CACpB,EAAe,QAAQ,EAAK,EAAU,MASlC,WAAsB,EAAwB,GAAO,CAC3D,MAAI,OAAO,SAAW,aAAe,4BAAQ,cACrC,EAAkB,OAAO,aAAc,GAG/C,GAAoB,uBAEb,KA8FD,YAAuB,CAC7B,MAAO,CACN,UAAW,CACV,MAAO,OAER,aAAc,GACd,UAAW,ICvQD,KAAC,GAAK,EAAQ,EAAS,CAClC,MAAO,GACP,OAAQ,6CACR,SAAU,6CACV,MAAO,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UACtH,YAAa,CAAC,UACd,MAAO,aACP,IAAK,aACL,KAAM,WACN,KAAM,GACN,SAAU,MACP,IAAgB"}