{"version":3,"file":"index.svelte-9345133e.js","sources":["../../../../../src/lib/variables.js","../../../../../src/lib/api.js","../../../../../src/routes/index.svelte"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols\nexport const variables = {\n\tMODE: import.meta.env.MODE,\n\tDEV: import.meta.env.DEV,\n\tPROD: import.meta.env.PROD,\n\tBASE_URL: import.meta.env.BASE_URL,\n\tAPI_ROOT: import.meta.env.VITE_API_ROOT\n}","// noinspection DuplicatedCode,JSUnusedGlobalSymbols\n\nimport { variables } from '$lib/variables'\n\nconst GLOBAL_TIMEOUT = 5000\nconst GLOBAL_RETRIES = 1\nconst GLOBAL_RETRY_DELAY = 100\n\nconst delay = delay => new Promise(resolve => setTimeout(() => resolve(), delay))\n\nconst fetchWithTimeout = async (resource, options = {}, f) => {\n\t//console.log(`fetchWithTimeout(${resource})`)\n\n\tlet id = null\n\tlet response\n\n\tif (typeof AbortController === 'function') {\n\t\tconst { timeout = GLOBAL_TIMEOUT } = options\n\t\tconst controller = new AbortController()\n\t\tid = setTimeout(() => controller.abort(), timeout)\n\n\t\tif (typeof f === 'function') {\n\t\t\t//console.log(`Server-side fetch ${resource}`)\n\t\t\tresponse = await f(resource, { ...options, signal: controller.signal })\n\t\t} else {\n\t\t\tresponse = await fetch(resource, { ...options, signal: controller.signal })\n\t\t}\n\t} else {\n\t\tif (typeof f === 'function') {\n\t\t\t//console.log(`Server-side fetch ${resource}`)\n\t\t\tresponse = await f(resource, options)\n\t\t} else {\n\t\t\tresponse = await fetch(resource, options)\n\t\t}\n\t}\n\n\tif (id !== null) {\n\t\tclearTimeout(id)\n\t}\n\n\treturn response\n}\n\nconst fetchWithRetryDelay = async (resource, options = {}, f, n = GLOBAL_RETRIES) => {\n\t//console.log(`fetchWithRetryDelay(${resource})`)\n\n\ttry {\n\t\treturn await fetchWithTimeout(resource, options, f)\n\t} catch(error) {\n\t\tconsole.error(error)\n\n\t\tif (n === 1) throw error\n\n\t\tawait delay(GLOBAL_RETRY_DELAY)\n\n\t\treturn fetchWithRetryDelay(resource, options, f, n - 1)\n\t}\n}\n\nexport const getContributions = (land, start, end, f, options) => fetchWithRetryDelay(`${variables.API_ROOT}/stat/land/contribution?landId=${land}&from=${start}&to=${end}`, options, f)","<!--suppress JSUnresolvedVariable -->\n\n<script>\n\timport { db } from '$lib/stores'\n\timport { getContributions } from '$lib/api'\n\timport Land from '$lib/components/Land.svelte'\n\n\t// noinspection JSUnusedGlobalSymbols\n\tlet owner = '0xB00Fc62B8B22243779A35effb8B98f18193daa09'\n\t// noinspection JSUnusedLocalSymbols\n\tlet lands = [134223, 134224, 134225, 133969, 133968, 133967, 133711, 133712, 133713, 133455, 133456, 133457, 150949]\n\tlet start = '2022-03-22'\n\tlet end = '2022-03-28'\n\tlet land = 134223\n\n\tif (Array.isArray($db.lands))  {\n\t\tif ($db.lands.length === 0) {\n\t\t\t$db.lands = [{\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tdata: {}\n\t\t\t}]\n\n\t\t\t$db.lands.map((p, i) => {\n\t\t\t\tif (p.start === start && p.end === end) {\n\t\t\t\t\tlands.map(async land => {\n\t\t\t\t\t\tlet contributions_api = await getContributions(land, start, end).catch(error => console.error(error))\n\t\t\t\t\t\t// noinspection UnnecessaryLocalVariableJS\n\t\t\t\t\t\tlet contributions_data = await contributions_api?.json().catch(error => console.error(error))\n\n\t\t\t\t\t\tif (typeof p.data === 'undefined') {\n\t\t\t\t\t\t\t$db.lands[i].data = {}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$db.lands[i].data[land] = contributions_data\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tconsole.log('Loaded from server')\n\t\t} else {\n\t\t\tlet found = false\n\n\t\t\t$db.lands.map(p => {\n\t\t\t\tif (p.start === start && p.end === end) {\n\t\t\t\t\tfound = true\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tif (found) {\n\t\t\t\t$db.lands.map((p, i) => {\n\t\t\t\t\tif (p.start === start && p.end === end) {\n\t\t\t\t\t\tif (p.data && Object.keys(p.data).length === 0) {\n\t\t\t\t\t\t\tlands.map(async land => {\n\t\t\t\t\t\t\t\tlet contributions_api = await getContributions(land, start, end).catch(error => console.error(error))\n\t\t\t\t\t\t\t\t// noinspection UnnecessaryLocalVariableJS\n\t\t\t\t\t\t\t\tlet contributions_data = await contributions_api?.json().catch(error => console.error(error))\n\n\t\t\t\t\t\t\t\tif (typeof p.data === 'undefined') {\n\t\t\t\t\t\t\t\t\t$db.lands[i].data = {}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$db.lands[i].data[land] = contributions_data\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tconsole.log('Loaded from server')\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Loaded from cache')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\t$db.lands.push({\n\t\t\t\t\tstart,\n\t\t\t\t\tend,\n\t\t\t\t\tdata: {}\n\t\t\t\t})\n\n\t\t\t\t$db.lands.map((p, i) => {\n\t\t\t\t\tif (p.start === start && p.end === end) {\n\t\t\t\t\t\tlands.map(async land => {\n\t\t\t\t\t\t\tlet contributions_api = await getContributions(land, start, end).catch(error => console.error(error))\n\t\t\t\t\t\t\t// noinspection UnnecessaryLocalVariableJS\n\t\t\t\t\t\t\tlet contributions_data = await contributions_api?.json().catch(error => console.error(error))\n\n\t\t\t\t\t\t\tif (typeof p.data === 'undefined') {\n\t\t\t\t\t\t\t\t$db.lands[i].data = {}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$db.lands[i].data[land] = contributions_data\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconsole.log('Loaded from server')\n\t\t\t}\n\t\t}\n\t}\n\n\tlet id = 0\n\tlet data = $db?.lands[0]['data'][land]['contribution']\n\tlet rows\n</script>\n\n<Land {id} {data} />"],"names":[],"mappings":"2oBACO,KAAM,GAAY,CACxB,KAAM,aACN,IAAK,GACL,KAAM,GACN,SAAU,SACV,SAAU,iDCFL,EAAiB,IACjB,EAAiB,EACjB,EAAqB,IAErB,EAAQ,GAAS,GAAI,SAAQ,GAAW,WAAW,IAAM,IAAW,IAEpE,EAAmB,MAAO,EAAU,EAAU,GAAI,IAAM,CAG7D,GAAI,GAAK,KACL,EAEJ,GAAI,MAAO,kBAAoB,WAAY,CAC1C,KAAM,CAAE,UAAU,GAAmB,EAC/B,EAAa,GAAI,iBACvB,EAAK,WAAW,IAAM,EAAW,QAAS,GAE1C,AAAI,MAAO,IAAM,WAEhB,EAAW,KAAM,GAAE,EAAU,OAAK,GAAL,CAAc,OAAQ,EAAW,UAE9D,EAAW,KAAM,OAAM,EAAU,OAAK,GAAL,CAAc,OAAQ,EAAW,cAGnE,AAAI,OAAO,IAAM,WAEhB,EAAW,KAAM,GAAE,EAAU,GAE7B,EAAW,KAAM,OAAM,EAAU,GAInC,MAAI,KAAO,MACV,aAAa,GAGP,GAGF,EAAsB,MAAO,EAAU,EAAU,GAAI,EAAG,EAAI,IAAmB,CAGpF,GAAI,CACH,MAAO,MAAM,GAAiB,EAAU,EAAS,SAC1C,EAAN,CAGD,GAFA,QAAQ,MAAM,GAEV,IAAM,EAAG,KAAM,GAEnB,YAAM,GAAM,GAEL,EAAoB,EAAU,EAAS,EAAG,EAAI,KAI1C,EAAmB,CAAC,EAAM,EAAO,EAAK,EAAG,IAAY,EAAoB,GAAG,EAAU,0CAA0C,UAAa,QAAY,IAAO,EAAS,8NChDjL,GAAQ,aACR,EAAM,aACN,EAAO,OAsFP,EAAK,gDAzFL,IAAS,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,WAKzG,MAAM,QAAQ,EAAI,UACjB,EAAI,MAAM,SAAW,MACxB,EAAI,QACH,QACA,MACA,aAGD,EAAI,MAAM,KAAK,EAAG,KACb,EAAE,QAAU,GAAS,EAAE,MAAQ,GAClC,EAAM,SAAU,QACX,QAA0B,GAAiB,EAAM,EAAO,GAAK,MAAM,GAAS,QAAQ,MAAM,IAE1F,OAA2B,kBAAmB,OAAO,MAAM,GAAS,QAAQ,MAAM,WAE3E,GAAE,MAAS,iBACrB,EAAI,MAAM,GAAG,eAGd,EAAI,MAAM,GAAG,KAAK,GAAQ,SAK7B,QAAQ,IAAI,8BAER,GAAQ,GAEZ,EAAI,MAAM,IAAI,IACT,EAAE,QAAU,GAAS,EAAE,MAAQ,GAClC,GAAQ,MAIN,EACH,EAAI,MAAM,KAAK,EAAG,KACb,EAAE,QAAU,GAAS,EAAE,MAAQ,IAC9B,EAAE,MAAQ,OAAO,KAAK,EAAE,MAAM,SAAW,EAC5C,GAAM,SAAU,QACX,QAA0B,GAAiB,EAAM,EAAO,GAAK,MAAM,GAAS,QAAQ,MAAM,IAE1F,OAA2B,kBAAmB,OAAO,MAAM,GAAS,QAAQ,MAAM,WAE3E,GAAE,MAAS,iBACrB,EAAI,MAAM,GAAG,eAGd,EAAI,MAAM,GAAG,KAAK,GAAQ,OAG3B,QAAQ,IAAI,uBAEZ,QAAQ,IAAI,wBAKf,GAAI,MAAM,MACT,QACA,MACA,UAGD,EAAI,MAAM,KAAK,EAAG,KACb,EAAE,QAAU,GAAS,EAAE,MAAQ,GAClC,EAAM,SAAU,QACX,QAA0B,GAAiB,EAAM,EAAO,GAAK,MAAM,GAAS,QAAQ,MAAM,IAE1F,OAA2B,kBAAmB,OAAO,MAAM,GAAS,QAAQ,MAAM,WAE3E,GAAE,MAAS,iBACrB,EAAI,MAAM,GAAG,eAGd,EAAI,MAAM,GAAG,KAAK,GAAQ,SAK7B,QAAQ,IAAI,8BAMJ,iBAAK,MAAM,GAAG,KAAQ,GAAM"}